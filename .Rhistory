geom_line(stat="summary")
ggplot(data,aes(hour,value,color = name)) +
geom_ribbon(aes(ymin = 0,ymax = value,x = hour)) +
geom_point(stat="summary") +
geom_line(stat="summary")
ggplot(data,aes(hour,value,color = name)) +
geom_ribbon() +
geom_point(stat="summary") +
geom_line(stat="summary")
ggplot(data,aes(hour,value,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary") +
geom_ribbon(show.legend = FALSE)
ggplot(data,aes(hour,value,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary") +
geom_ribbon(aes(ymin = 0,ymax = value,x = hour),show.legend = FALSE)
data <- flights %>%
select(hour, dep_delay, arr_delay) %>%
mutate(max = max(value)) %>%
filter(hour> 4) %>%
pivot_longer(!hour)
data <- flights %>%
data <- flights %>%
library(dplyr)
data <- flights %>%
select(hour, dep_delay, arr_delay) %>%
filter(hour> 4) %>%
pivot_longer(!hour) %>%
mutate(r = value^2 + 0.5*value) %>%
mutate(l = value^2 - 0.5*value)
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(nycflights13)
library(magrittr)
library(dplyr)
data <- flights %>%
select(hour, dep_delay, arr_delay) %>%
filter(hour> 4) %>%
pivot_longer(!hour) %>%
mutate(r = value^2 + 0.5*value) %>%
mutate(l = value^2 - 0.5*value)
View(data)
ggplot(data,aes(hour,value,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary") +
geom_ribbon(aes(ymin = l,ymax = r,x = hour),alpha = 0.3)
ggplot(data,aes(hour,value,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary") +
geom_ribbon(aes(ymin = l,ymax = r),alpha = 0.3)
ggplot(data,aes(hour,value,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary") +
geom_ribbon(aes(ymin = l,ymax = r,x = x),alpha = 0.3)
ggplot(data,aes(hour,value,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary") +
geom_ribbon(aes(ymin = l,ymax = r,x = hour),alpha = 0.3)
ggplot(data,aes(hour,value,ymin = value - l,ymax = value + r,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary")
ggplot(data,aes(hour,value,ymin = value - l,ymax = value + r,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary") +
geom_ribbon()
ggplot(data,aes(hour,value,color = name)) +
geom_point(stat="summary") +
geom_line(stat="summary") +
geom_ribbon()
num <- {1,2,3}
num <- list(1,2,3)
num
num <- array(1,2,3)
num[1]
num <- list(c(1,3))
num[1]
num <- list(1302,1333,1290,1171,1176,1123,1095,1096)
print(i)
for(i in 1:8){
print(i)
}
list[i]
for(i in 1:8){
list[i]
}
for(i in 1:8){
num[i]
}
for(i in 1:8){
print(num[i])
}
for(i in 1:8){
print(1302/num[i])
}
for(i in 1:8){
print(1302/as.integer(num[i]))
}
for(i in 1:8){
print(as.integer(num[i])/1365.58+37.24*4.5))
}
for(i in 1:8){
print(as.integer(num[i])/(1365.58+37.24*4.5))
}
for(i in 1:8){
print(as.integer(num[i])/(1365.58+37.24*i))
}
for(i in 1:8){
print(1365.58+37.24*i)
print(as.integer(num[i])/(1365.58+37.24*i))
}
for(i in 1:8){
print(1365.58+37.24*i)
#print(as.integer(num[i])/(1365.58+37.24*i))
}
for(i in 1:8){
print(1365.58-37.24*i)
#print(as.integer(num[i])/(1365.58+37.24*i))
}
a <- list()
for(i in 1:8){
print(1365.58-37.24*i)
a[i] <- as.integer(num[i])/(1365.58+37.24*i)
}
for(i in 1:8){
print(1365.58-37.24*i)
a[i] <- as.integer(num[i])/(1365.58+37.24*i)
print("a = ",a[i])
}
for(i in 1:8){
print(1365.58-37.24*i)
a[i] <- as.integer(num[i])/(1365.58+37.24*i)
print("a = "a[i])
}
for(i in 1:8){
print(1365.58-37.24*i)
a[i] <- as.integer(num[i])/(1365.58+37.24*i)
print("a = %d",a[i])
}
for(i in 1:8){
print(1365.58-37.24*i)
a[i] <- as.integer(num[i])/(1365.58+37.24*i)
print("a = ")
print(a[i])
}
for(i in 1:8){
a[i] <- as.integer(num[i])/(1365.58+37.24*i)
print(a[i])
}
for(i in 1:8){
a[i] <- as.integer(num[i])/(1365.58-37.24*i)
print(a[i])
}
a105 <- list(293.74,309.40,293.53,279.57)
a106 <- list(287.43,283.59,281.95,269.94)
a107 <- list(277.29,282.47,275.26,259.90)
a108 <- list(267.27,285.51,276.26,266.62)
data_ts <- ts(data$Usage,start = min(index(data)),end = max(index(data)),frequency = 7)
setwd("D:/NCTU_NOT_NYCU/Personal_Project/2011-2022data_process")
library(tidyverse)
library(tseries)
library(forecast)#arima
library(dplyr)
library(lubridate) #提取月份
library(xts) #as.xts
data <- readRDS("data.rds")
data_ts <- ts(data$Usage,start = min(index(data)),end = max(index(data)),frequency = 7)
acf(data_ts)
pacf(data_ts)
拆解 <- decompose(data_ts)
plot(拆解)
data <- readRDS("data.rds")
data_ts <- ts(data$Usage,start = min(index(data)),end = max(index(data)),frequency = 7)
#建模
auto.arima(data_ts,stepwise = F,trace = T,stationary = T,ic = c("aic"))
fit <- arima(data_ts,order = c(1,0,1),seasonal = list(order = c(2,0,0),period = 7)) #SARMA
#模型檢查
#lambda填上lambda轉換次數+1
p <- forecast(fit,10,lambda = 1)
plot(p)
#模型檢查
#lambda填上lambda轉換次數+1
p <- forecast(fit,100,lambda = 1)
plot(p)
#模型檢查
tsdisplay(residuals(fit),lag,max = 50,main = '殘差')
#模型檢查
tsdisplay(residuals(fit),lag,.ax = 50,main = '殘差')
#模型檢查
tsdisplay(residuals(fit),lag.ax = 50,main = '殘差')
shapiro.test(fit$residuals)
#模型檢查
tsdisplay(residuals(fit),lag.max = 50,main = '殘差')
shapiro.test(fit$residuals)
Box.test(fir$residuals,lag = 10,type = "Ljung-Box")
Box.test(fit$residuals,lag = 10,type = "Ljung-Box")
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
data_ts <- diff(data_ts,lag = 1)
#建模
#order(AR,I,MA)(S)
auto.arima(data_ts,stepwise = F,trace = T,stationary = T,ic = c("aic"))
#模型檢查
tsdisplay(residuals(fit),lag.max = 50,main = '殘差')
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
data_ts <- ts(data$Usage,start = min(index(data)),end = max(index(data)),frequency = 7)
data_ts <- diff(data_ts,lag = 2)
#建模
#order(AR,I,MA)(S)
auto.arima(data_ts,stepwise = F,trace = T,stationary = T,ic = c("aic"))
data <- readRDS("data.rds")
data_ts <- ts(data$Usage,start = min(index(data)),end = max(index(data)),frequency = 7)
data_ts_ex <- data_ts %>%
filter(index(data_ts) > "2019-01-01")
View(data)
library(stats)
data_ts_ex <- data_ts %>%
filter(index(data_ts) > "2019-01-01")
data_ts_ex <- data_ts %>%
filter(index() > "2019-01-01")
data_rx <- subset(data_ts,index(data_ts) > "2019-01-01")
data <- readRDS("data.rds")
data_ts <- ts(data$Usage,start = min(index(data)),end = max(index(data)),frequency = 7)
data_ex <- subset(data_ts,index(data_ts) > "2019-01-01")
data <- readRDS("data.rds")
View(data)
data_ex <- subset(data$Usage,index(data) < "2019-01-01")
View(data_ex)
data_control <- subset(data$Usage,index(data) >= "2019-01-01")
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex)),frequency = 7)
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex)),frequency = 7))
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex)),frequency = 7))
data_ts2 <- ts(data_control$Usage,start = min(index(data_control),end = max(index(data_control)),frequency = 7))
拆解 <- decompose(data_ts1)
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex))),frequency = 7)
data_ts2 <- ts(data_control$Usage,start = min(index(data_control),end = max(index(data_control))),frequency = 7)
拆解 <- decompose(data_ts1)
plot(拆解)
acf.test(data_ts1)
library(tidyverse)
library(tseries)
library(forecast)#arima
library(dplyr)
library(lubridate) #提取月份
library(xts) #as.xts
adf.test(data_ts1)
#因為非stationary，故要進行lambda轉換
lambda轉換 <- BoxCox(data_ts1,lambda = "auto")
data <- readRDS("data.rds")
data_ex <- subset(data$Usage,index(data) < "2019-01-01")
data_control <- subset(data$Usage,index(data) >= "2019-01-01")
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex))),frequency = 7)
拆解 <- decompose(data_ts1)
plot(拆解)
adf.test(data_ts1)
#因為非stationary，故要進行lambda轉換
lambda轉換 <- BoxCox(data_ts1,lambda = "auto")
adf.test(lambda轉換)
#轉換值
BoxCox.lambda(lambda轉換)
差分 <- diff(data_ts1,differences = 1)
adf.test(差分且轉換)
差分且轉換 <- diff(BoxCox(data_ts1,lambda = "auto"),differences = 1)
adf.test(差分且轉換)
#建模
#order(AR,I,MA)(S)
auto.arima(lambda轉換,stepwise = F,trace = T,stationary = T,ic = c("aic"))
fit <- arima(data_ts,order = c(1,1,0),seasonal = list(order = c(2,0,0),period = 7),include.mean = FALSE) #SARMA
fit <- arima(lambda轉換,order = c(1,1,0),seasonal = list(order = c(2,0,0),period = 7),include.mean = FALSE) #SARMA
#模型檢查
tsdisplay(residuals(fit),lag.max = 50,main = '殘差')
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
shapiro.test(fit$residuals)
#預測誤差及討論空間
#lambda填上lambda轉換次數+1
p <- forecast(fit,100,lambda = 2)
plot(p)
#建模
#order(AR,I,MA)(S)
#SARI模型
auto.arima(lambda轉換,stepwise = F,trace = T,stationary = T,ic = c("aic"))
#模型檢查
tsdisplay(residuals(fit),lag.max = 50,main = '殘差')
shapiro.test(fit$residuals)
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
#預測誤差及討論空間
#lambda填上lambda轉換次數+1
p <- forecast(fit,100,lambda = 2)
plot(p)
View(data_ex)
shapiro.test(fit$residuals)
#顯著性值少於 0.05 表示殘差誤不是隨機的，暗示在觀察數列中有模型未說明的結構。
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
data <- readRDS("data.rds")
data_ex <- subset(data$Usage,index(data) < "2019-01-01")
data_control <- subset(data$Usage,index(data) >= "2019-01-01")
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex))),frequency = 7)
拆解 <- decompose(data_ts1)
plot(拆解)
adf.test(data_ts1)
#因為非stationary，故要進行lambda轉換(轉換後還是不穩定，後來使用轉換又差分的方式)
lambda轉換 <- BoxCox(data_ts1,lambda = "auto")
#轉換值
BoxCox.lambda(lambda轉換) #0.7053499
#差分且轉換就過了(p-value < 0.05)
#有足夠的證據去推翻不穩定的假設
差分且轉換 <- diff(BoxCox(data_ts1,lambda = "auto"),differences = 1)
adf.test(差分且轉換)
#建模
#order(AR,I,MA)(S)
#SARI模型
auto.arima(lambda轉換,stepwise = F,trace = T,stationary = T,ic = c("aic"))
fit <- arima(lambda轉換,order = c(1,1,0),seasonal = list(order = c(2,0,0),period = 7),include.mean = FALSE) #SARMA
#模型檢查
tsdisplay(residuals(fit),lag.max = 50,main = '殘差')
#不符合常態分布
#https://officeguide.cc/r-normality-test-tutorial/
shapiro.test(fit$residuals)
#顯著性值少於 0.05 表示殘差誤不是隨機的，暗示在觀察數列中有模型未說明的結構。
#https://www.ibm.com/docs/zh-tw/spss-modeler/SaaS?topic=node-examining-model
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
#預測誤差及討論空間
#lambda填上lambda轉換次數+1
p <- forecast(fit,100,lambda = 2)
plot(p)
預測 <- as.data.frame(p)
評估 <- cbind(data_ex,data_control)
View(評估)
data_control <- subset(data$Usage,index(data) >= "2019-01-01")
評估 <- cbind(data_ex,data_control)
View(評估)
評估 <- as.data.frame(Usage1 = data_ex,Usage2 = data_control)
評估 <- as.data.frame(x = data_ex,Usage2 = data_control)
data <- readRDS("data.rds")
data_ex <- subset(data$Usage,index(data) < "2019-01-01")
data_control <- subset(data$Usage,index(data) >= "2019-01-01")
評估 <- as.data.frame(x = data_ex,Usage2 = data_control)
View(評估)
評估 <- as.data.frame(x = data_ex$Usage,Usage2 = data_control$Usage)
View(評估)
評估 <- as.data.frame(x = coredata(data_ex),Usage2 = coredata(data_control))
View(評估)
data1 <- as.data.frame(x = coredata(data_ex))
data2 <- as.data.frame(x = coredata(data_control))
評估 <- cbind(data1,data2)
View(data1)
View(data2)
評估 <- cbind(data1,data-1)
data2[-c(731),]
data2[1,]
View(data2)
data2[-c(1),]
a <- data2[-c(1),]
View(data2)
data <- readRDS("data.rds")
data_ex <- subset(data$Usage,index(data) < "2019-01-01")
data_control <- subset(data$Usage,index(data) >= "2019-01-01")
View(data_control)
data1 <- as.data.frame(x = coredata(data_ex))
data2 <- as.data.frame(x = coredata(data_control))
View(data2)
評估 <- cbind(data1,data2[-c(425),])
View(評估)
colnames(評估) <- c("實驗組","對照組")
View(評估)
data <- readRDS("data.rds")
data_ex <- subset(data$Usage,index(data) < "2019-01-01")
data_control <- subset(data$Usage,index(data) >= "2019-01-01")
data2 <- as.data.frame(x = coredata(data_control))
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex))),frequency = 7)
拆解 <- decompose(data_ts1)
plot(拆解)
adf.test(data_ts1)
#因為非stationary，故要進行lambda轉換(轉換後還是不穩定，後來使用轉換又差分的方式)
lambda轉換 <- BoxCox(data_ts1,lambda = "auto")
#轉換值
BoxCox.lambda(lambda轉換) #0.7053499
#差分且轉換就過了(p-value < 0.05)
#有足夠的證據去推翻不穩定的假設
差分且轉換 <- diff(BoxCox(data_ts1,lambda = "auto"),differences = 1)
adf.test(差分且轉換)
#建模
#order(AR,I,MA)(S)
#SARI模型
auto.arima(lambda轉換,stepwise = F,trace = T,stationary = T,ic = c("aic"))
fit <- arima(lambda轉換,order = c(1,1,0),seasonal = list(order = c(2,0,0),period = 7),include.mean = FALSE) #SARMA
#模型檢查
tsdisplay(residuals(fit),lag.max = 50,main = '殘差')
#不符合常態分布
#https://officeguide.cc/r-normality-test-tutorial/
shapiro.test(fit$residuals)
#顯著性值少於 0.05 表示殘差誤不是隨機的，暗示在觀察數列中有模型未說明的結構。
#https://www.ibm.com/docs/zh-tw/spss-modeler/SaaS?topic=node-examining-model
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
#預測誤差及討論空間
#lambda填上lambda轉換次數+1
p <- forecast(fit,100,lambda = 2)
plot(p)
預測 <- as.data.frame(p)
評估 <- cbind(p,data2[-c(425),])
View(評估)
View(評估)
預測 <- as.data.frame(p)
評估 <- cbind(p,data2[-c(425),])
View(評估)
data <- readRDS("data.rds")
data_ex <- subset(data$Usage,index(data) < "2019-01-01")
data_control <- subset(data$Usage,index(data) >= "2019-01-01")
data2 <- as.data.frame(x = coredata(data_control))
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex))),frequency = 7)
拆解 <- decompose(data_ts1)
adf.test(data_ts1)
#因為非stationary，故要進行lambda轉換(轉換後還是不穩定，後來使用轉換又差分的方式)
lambda轉換 <- BoxCox(data_ts1,lambda = "auto")
#轉換值
BoxCox.lambda(lambda轉換) #0.7053499
#差分且轉換就過了(p-value < 0.05)
#有足夠的證據去推翻不穩定的假設
差分且轉換 <- diff(BoxCox(data_ts1,lambda = "auto"),differences = 1)
adf.test(差分且轉換)
#建模
#order(AR,I,MA)(S)
#SARI模型
auto.arima(lambda轉換,stepwise = F,trace = T,stationary = T,ic = c("aic"))
fit <- arima(lambda轉換,order = c(1,1,0),seasonal = list(order = c(2,0,0),period = 7),include.mean = FALSE) #SARMA
#模型檢查
tsdisplay(residuals(fit),lag.max = 50,main = '殘差')
#不符合常態分布
#https://officeguide.cc/r-normality-test-tutorial/
shapiro.test(fit$residuals)
#顯著性值少於 0.05 表示殘差誤不是隨機的，暗示在觀察數列中有模型未說明的結構。
#https://www.ibm.com/docs/zh-tw/spss-modeler/SaaS?topic=node-examining-model
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
#預測誤差及討論空間
#lambda填上lambda轉換次數+1
p <- forecast(fit,100,lambda = 2)
plot(p)
View(評估)
colnames(評估) <- c("test","Usage")
評估 <- 評估 %>%
mutate(mae = abs(Usage - 評估$`Point Forecast`)) %>%
mutate(mape = abs(Usage - 評估$`Point Forecast`)/Usage)
library(tidyverse)
library(tseries)
library(forecast)#arima
library(dplyr)
library(lubridate) #提取月份
library(xts) #as.xts
預測 <- as.data.frame(p)
評估 <- cbind(p,data2[-c(425),])
#預測誤差及討論空間
#lambda填上lambda轉換次數+1
p <- forecast(fit,100,lambda = 2)
plot(p)
預測 <- as.data.frame(p)
評估 <- cbind(p,data2[-c(425),])
colnames(評估) <- c("test","Usage")
評估 <- 評估 %>%
mutate(mae = abs(Usage - 評估$`Point Forecast`)) %>%
mutate(mape = abs(Usage - 評估$`Point Forecast`)/Usage)
mean(評估)
data_control <- as.data.frame(subset(data$Usage,index(data) >= "2019-01-01"))
View(data_control)
View(data_control)
class(data_control)
data_ex <- as.data.frame(subset(data$Usage,index(data) < "2019-01-01"))
data_control <- as.data.frame(subset(data$Usage,index(data) >= "2019-01-01"))
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex))),frequency = 7)
data <- readRDS("data.rds")
data_ex <- as.data.frame(subset(data$Usage,index(data) < "2019-01-01"))
data_control <- as.data.frame(subset(data$Usage,index(data) >= "2019-01-01"))
data_ts1 <- ts(data_ex$Usage,start = min(index(data_ex),end = max(index(data_ex))),frequency = 7)
拆解 <- decompose(data_ts1)
plot(拆解)
adf.test(data_ts1)
#因為非stationary，故要進行lambda轉換(轉換後還是不穩定，後來使用轉換又差分的方式)
lambda轉換 <- BoxCox(data_ts1,lambda = "auto")
#轉換值
BoxCox.lambda(lambda轉換) #0.7053499
#差分且轉換就過了(p-value < 0.05)
#有足夠的證據去推翻不穩定的假設
差分且轉換 <- diff(BoxCox(data_ts1,lambda = "auto"),differences = 1)
adf.test(差分且轉換)
#建模
#order(AR,I,MA)(S)
#SARI模型
auto.arima(lambda轉換,stepwise = F,trace = T,stationary = T,ic = c("aic"))
fit <- arima(lambda轉換,order = c(1,1,0),seasonal = list(order = c(2,0,0),period = 7),include.mean = FALSE) #SARMA
#模型檢查
tsdisplay(residuals(fit),lag.max = 50,main = '殘差')
#不符合常態分布
#https://officeguide.cc/r-normality-test-tutorial/
shapiro.test(fit$residuals)
#顯著性值少於 0.05 表示殘差誤不是隨機的，暗示在觀察數列中有模型未說明的結構。
#https://www.ibm.com/docs/zh-tw/spss-modeler/SaaS?topic=node-examining-model
Box.test(fit$residuals,lag = 14,type = "Ljung-Box")
#預測誤差及討論空間
#lambda填上lambda轉換次數+1
p <- forecast(fit,100,lambda = 0.7053499)
plot(p)
預測 <- as.data.frame(p)
評估 <- cbind(p,data2[-c(425),])
評估 <- cbind(p,data_control[-c(425),])
colnames(評估) <- c("test","Usage")
評估 <- 評估 %>%
mutate(mae = abs(Usage - 評估$`Point Forecast`)) %>%
mutate(mape = abs(Usage - 評估$`Point Forecast`)/Usage)
mean(評估)
p
plot(p)
#轉換值
BoxCox.lambda(lambda轉換) #0.7053499
